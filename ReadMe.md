# Лабораторная работа 1

## Начало работы
### Инициализируем контейнер с базой данных
```powershell
docker run --name pg-lab -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=labdb -p 5432:5432 -v ${PWD}:/db -d postgres:14
```
### Покдлючаемся к базе данных
```powershell
docker exec -it pg-lab psql -U postgres -d demo
```
### Отключаем постраничное отображение базы данных
```sql
\pset pager off
```

## Блок 1
### Задание (вариант 2)
Найти рейсы, прибывшие в SVO в интервале с 16:00 до 19:00 2017-07-22
### Запуск
```sql
\i /db/block1_task2.sql
```
### Скрипт
```sql
SELECT *
FROM bookings.flights
WHERE arrival_airport = 'SVO'
  AND scheduled_arrival BETWEEN
      '2017-07-22 16:00:00+00' AND '2017-07-22 19:00:00+00';
```
### Вывод
```
 flight_id | flight_no |  scheduled_departure   |   scheduled_arrival    | departure_airport | arrival_airport | status  | aircraft_code |    actual_departure    |     actual_arrival     
-----------+-----------+------------------------+------------------------+-------------------+-----------------+---------+---------------+------------------------+------------------------
      8454 | PG0477    | 2017-07-22 15:20:00+00 | 2017-07-22 16:10:00+00 | LED               | SVO             | Arrived | 321           | 2017-07-22 15:25:00+00 | 2017-07-22 16:15:00+00
     18053 | PG0704    | 2017-07-22 07:45:00+00 | 2017-07-22 16:30:00+00 | UUS               | SVO             | Arrived | 319           | 2017-07-22 07:49:00+00 | 2017-07-22 16:35:00+00
     20385 | PG0181    | 2017-07-22 16:05:00+00 | 2017-07-22 16:35:00+00 | GOJ               | SVO             | Arrived | SU9           | 2017-07-22 16:09:00+00 | 2017-07-22 16:39:00+00
     23242 | PG0101    | 2017-07-22 13:30:00+00 | 2017-07-22 16:30:00+00 | NFG               | SVO             | Arrived | CR2           | 2017-07-22 13:33:00+00 | 2017-07-22 16:33:00+00
     25115 | PG0453    | 2017-07-22 12:25:00+00 | 2017-07-22 16:20:00+00 | BAX               | SVO             | Arrived | SU9           | 2017-07-22 12:32:00+00 | 2017-07-22 16:26:00+00
     25987 | PG0284    | 2017-07-22 16:00:00+00 | 2017-07-22 17:05:00+00 | ULY               | SVO             | Arrived | CR2           | 2017-07-22 16:04:00+00 | 2017-07-22 17:09:00+00
     28572 | PG0638    | 2017-07-22 16:15:00+00 | 2017-07-22 17:15:00+00 | KVX               | SVO             | Arrived | SU9           | 2017-07-22 16:17:00+00 | 2017-07-22 17:17:00+00
     29540 | PG0067    | 2017-07-22 15:45:00+00 | 2017-07-22 17:30:00+00 | STW               | SVO             | Arrived | CR2           | 2017-07-22 15:51:00+00 | 2017-07-22 17:35:00+00
     30401 | PG0162    | 2017-07-22 16:00:00+00 | 2017-07-22 16:30:00+00 | BZK               | SVO             | Arrived | SU9           | 2017-07-22 16:03:00+00 | 2017-07-22 16:33:00+00
     30402 | PG0161    | 2017-07-22 17:20:00+00 | 2017-07-22 17:50:00+00 | BZK               | SVO             | Arrived | SU9           | 2017-07-22 17:23:00+00 | 2017-07-22 17:53:00+00
     30580 | PG0013    | 2017-07-22 15:15:00+00 | 2017-07-22 17:00:00+00 | AER               | SVO             | Arrived | 773           | 2017-07-22 15:15:00+00 | 2017-07-22 16:59:00+00
     33096 | PG0063    | 2017-07-22 16:25:00+00 | 2017-07-22 17:10:00+00 | SKX               | SVO             | Arrived | CR2           | 2017-07-22 16:25:00+00 | 2017-07-22 17:10:00+00
```

## Блок 2
### Задание (вариант 1)
Cдвиньте время вылета всех рейсов вылетающих ночью с 2017-09-11/2017-09-12 (вылетающих между 23:00 и 06:00) на 30 минут позже
### Запуск
```sql
\i /db/block2_task1.sql
```
### Скрипт
```sql
UPDATE bookings.flights
SET scheduled_departure = scheduled_departure + INTERVAL '30 minutes',
    scheduled_arrival   = scheduled_arrival   + INTERVAL '30 minutes'
WHERE scheduled_departure::time >= '23:00:00' OR scheduled_departure::time <= '06:00:00'
  AND scheduled_departure::date BETWEEN '2017-09-11' AND '2017-09-12';
```
### Вывод
```
UPDATE 210
```

## Блок 3
### Задание (вариант 1)
Рассчитайте количество рейсов и среднюю продолжительность полета для каждого аэропорта вылета
### Запуск
```sql
\i /db/block3_task1.sql
```
### Скрипт
```sql
SELECT departure_airport,
       COUNT(*) AS flight_count,
       AVG(EXTRACT(EPOCH FROM (scheduled_arrival - scheduled_departure))/3600) AS avg_duration_hours
FROM bookings.flights
GROUP BY departure_airport
ORDER BY departure_airport;
```
### Вывод
```
 departure_airport | flight_count |   avg_duration_hours   
-------------------+--------------+------------------------
 AAQ               |          131 | 1.51335877862595421170 
 ABA               |          235 | 2.13794326241134752766 
 AER               |          584 | 2.19991438356164383368 
 ARH               |          323 | 2.53018575851393188597 
 ASF               |          148 |     2.3231981981981982 
 BAX               |          156 |     3.2094017094017094 
 BQS               |           61 | 0.83333333333333333333 
 BTK               |           61 |     5.0833333333333333 
 BZK               |          610 | 0.46666666666666666667 
 CEE               |          131 |     1.5941475826972010 
 CEK               |          409 | 2.47738386308068460652 
 CNN               |          158 |     3.6355485232067510 
 CSY               |          305 | 1.26666666666666667333 
 DME               |         3217 | 2.14879287120505646632 
 DYR               |           36 |     7.1875000000000000
 EGO               |          366 | 1.48611111111111111667
 ESL               |          297 |     2.5406846240179573
 EYK               |           53 |     2.6022012578616352
 GDX               |           36 |     5.7500000000000000
 GDZ               |          113 |     1.6688790560471976
 GOJ               |          357 | 1.15592903828197946415
 GRV               |           70 |     2.4369047619047619
 HMA               |          515 | 2.61488673139158577295
 HTA               |           96 |     3.9010416666666667
 IAR               |           79 |     2.2373417721518987
 IJK               |           61 |     1.4166666666666667
 IKT               |          366 |     3.7326958105646630
 IWA               |           34 |     1.9583333333333334
 JOK               |          261 |     2.1363346104725415
 KEJ               |           87 |     3.5000000000000000
 KGD               |          157 |     1.7404458598726115
 KGP               |          192 |     2.6614583333333334
 KHV               |          400 | 3.59520833333333333992
 KJA               |          707 |     2.3538425271098538
 KLF               |          122 |     2.3374316939890711
 KRO               |          211 |     2.4668246445497631
 KRR               |          236 |     1.8079096045197740
 KUF               |          183 |     2.0000000000000000
 KVX               |          366 | 1.98611111111111111111
 KXK               |           18 |     6.2500000000000000
 KYZ               |           43 | 1.89728682170542636279
 KZN               |          471 | 2.24203821656050957198
 LED               |         1900 | 2.17258771929824561802
 LPK               |           43 |     2.0387596899224806
 MCX               |          200 | 1.69500000000000000000
 MJZ               |          383 |     2.9249347258485640
 MMK               |          122 |     2.0000000000000000
 MQF               |          244 | 1.43750000000000000000
 MRV               |          209 | 1.89473684210526314115
 NAL               |          183 |     1.7500000000000000
 NBC               |          227 | 1.71769456681350952937
 NFG               |           44 |     3.0000000000000000
 NJC               |          192 | 2.60590277777777776719
 NNM               |          157 | 1.66188959660297241571
 NOJ               |          184 |     1.8134057971014493
 NOZ               |          365 | 1.44406392694063928365
 NSK               |          139 |     3.1217026378896882
 NUX               |          506 |     2.2210144927536232
 NYA               |           27 |     2.7777777777777778
 NYM               |          140 |     2.9880952380952381
 OGZ               |          122 |     2.0833333333333334
 OMS               |          200 |     2.7045833333333333
 OSW               |           71 |     2.2769953051643192
 OVB               |         1055 | 2.21137440758293839634
 OVS               |          549 | 1.76851851851851852222
 PEE               |          619 | 1.69413031771674743883
 PES               |          358 | 1.99022346368715082821
 PEZ               |          244 |     2.2916666666666667
 PKC               |           26 |     8.8333333333333333
 PKV               |           96 |     1.9539930555555556
 PYJ               |           27 |     3.6388888888888889
 REN               |          305 | 1.69999999999999999333
 RGK               |           88 |     2.3219696969696969
 ROV               |          617 | 1.64276066990815775732
 RTW               |          244 | 1.14583333333333332500
 SCW               |          253 |     1.9361001317523056
 SGC               |          531 | 2.31763967357187698136
 SKX               |          122 | 0.75000000000000000000
 SLY               |          122 |     2.5000000000000000
 STW               |          123 |     2.1158536585365854
 SVO               |         2981 | 2.00617801632561780746
 SVX               |          689 | 1.78156748911465892937
 SWT               |           61 |     3.6666666666666667
 TBW               |          244 |     2.3333333333333334
 TJM               |          427 | 1.88914910226385635472
 TOF               |          254 | 2.63549868766404199134
 UCT               |          183 |     2.6111111111111111
 UFA               |          384 | 2.03081597222222222908
 UIK               |          175 |     2.4461904761904762
 UKX               |           61 |     2.6666666666666667
 ULV               |          392 | 1.11798469387755101301
 ULY               |          192 |     1.2556423611111111
 URJ               |          122 | 1.33333333333333333334
 URS               |          139 | 2.03717026378896881031
 USK               |           18 |     2.2083333333333334
 UUA               |          183 | 1.08333333333333333333
 UUD               |           71 |     4.1009389671361502
 UUS               |          262 |     5.1695292620865140
 VKO               |         1719 | 1.97357960054295133201
 VKT               |          280 |     2.5523809523809524
 VOG               |          314 | 1.56687898089171974427
 VOZ               |          122 | 1.04166666666666666667
 VVO               |          183 | 4.16666666666666667778
 YKS               |          166 |     3.5316265060240964
```